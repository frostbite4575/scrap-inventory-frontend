<div class="add-scrap">
  <h2>Add New Scrap Piece</h2>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="message success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="message error">
    {{ errorMessage }}
  </div>

  <form (ngSubmit)="onSubmit()" #scrapForm="ngForm">
    <!-- Step 1: Select Material from Catalog -->
    <div class="form-section">
      <h3>1. Select Material</h3>

      <div class="form-group">
        <label for="catalogMaterial">Material *</label>
        <select
          id="catalogMaterial"
          name="catalogMaterial"
          [(ngModel)]="selectedCatalogMaterialId"
          (ngModelChange)="onCatalogMaterialChange()"
          required>
          <option value="">Select Material</option>
          <option *ngFor="let material of catalogMaterials" [value]="material.id">
            {{ material.description }}
          </option>
        </select>
      </div>

      <!-- Display selected material info -->
      <div *ngIf="selectedCatalogMaterial" class="material-info">
        <h4>Selected Material:</h4>
        <p><strong>Size:</strong> {{ selectedCatalogMaterial.size }}</p>
        <p><strong>Thickness:</strong> {{ selectedCatalogMaterial.thickness }}"</p>
        <p><strong>Grade:</strong> {{ selectedCatalogMaterial.grade }}</p>
        <p *ngIf="selectedCatalogMaterial.notes"><strong>Notes:</strong> {{ selectedCatalogMaterial.notes }}</p>
      </div>
    </div>

    <!-- Step 2: Enter Piece Dimensions -->
    <div class="form-section">
      <h3>2. Enter Piece Dimensions</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="length">Length (inches) *</label>
          <input
            type="number"
            id="length"
            name="length"
            [(ngModel)]="length"
            step="0.01"
            required
            min="0">
        </div>

        <div class="form-group">
          <label for="width">Width (inches) *</label>
          <input
            type="number"
            id="width"
            name="width"
            [(ngModel)]="width"
            step="0.01"
            required
            min="0">
        </div>
      </div>
    </div>

    <!-- Step 3: Location -->
    <div class="form-section">
      <h3>3. Location</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="area">Area</label>
          <select
            id="area"
            name="area"
            [(ngModel)]="selectedAreaId"
            (ngModelChange)="onAreaChange()">
            <option value="">Select Area</option>
            <option *ngFor="let area of areas" [value]="area.id">
              {{ area.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="section">Section</label>
          <select
            id="section"
            name="section"
            [(ngModel)]="selectedSectionId"
            (ngModelChange)="onSectionChange()"
            [disabled]="!selectedAreaId">
            <option value="">Select Section</option>
            <option *ngFor="let section of sections" [value]="section.id">
              {{ section.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="bin">Bin</label>
          <select
            id="bin"
            name="bin"
            [(ngModel)]="selectedBin"
            [disabled]="!selectedSectionId">
            <option value="">Select Bin</option>
            <option *ngFor="let bin of bins" [value]="bin">
              {{ bin }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Step 4: Additional Details -->
    <div class="form-section">
      <h3>4. Additional Details</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="addedBy">Your Name *</label>
          <input
            type="text"
            id="addedBy"
            name="addedBy"
            [(ngModel)]="addedBy"
            required>
        </div>
      </div>

      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea
          id="notes"
          name="notes"
          [(ngModel)]="notes"
          rows="3"
          placeholder="Any notes about this piece..."></textarea>
      </div>
    </div>

    <!-- Buttons -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="loading || !scrapForm.form.valid">
        <span *ngIf="!loading">Add Scrap Piece</span>
        <span *ngIf="loading">‚è≥ Adding...</span>
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="clearForm()"
        [disabled]="loading">
        Clear Form
      </button>
    </div>
  </form>
</div>
